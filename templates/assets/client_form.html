{% extends "base.html" %}
{% load static %}

{% block title %}
  {% if client %}Modifier Client{% else %}Ajouter Client{% endif %} - RadGestMat
{% endblock %}

{% block content %}
<div class="container py-4">
  <h2 class="mb-4">
    {% if client %}
      <i class="bi bi-pencil me-2"></i>Modifier Client
    {% else %}
      <i class="bi bi-person-plus me-2"></i>Ajouter Client
    {% endif %}
  </h2>

  <form method="post" class="needs-validation" novalidate>
    {% csrf_token %}

    <!-- Messages d'erreur globaux -->
    {% if form.non_field_errors %}
    <div class="alert alert-danger">
      {{ form.non_field_errors }}
    </div>
    {% endif %}

    <!-- Informations générales -->
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0"><i class="bi bi-info-circle me-2"></i>Informations générales *</h5>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="{{ form.nom.id_for_label }}" class="form-label">{{ form.nom.label }}</label>
            {{ form.nom }}
            {% if form.nom.errors %}
              <div class="invalid-feedback d-block">{{ form.nom.errors.0 }}</div>
            {% endif %}
          </div>
          <div class="col-md-6 mb-3">
            <label for="{{ form.type_client.id_for_label }}" class="form-label">{{ form.type_client.label }}</label>
            {{ form.type_client }}
            {% if form.type_client.errors %}
              <div class="invalid-feedback d-block">{{ form.type_client.errors.0 }}</div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    <!-- Coordonnées -->
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0"><i class="bi bi-telephone me-2"></i>Coordonnées</h5>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="{{ form.email.id_for_label }}" class="form-label">{{ form.email.label }}</label>
            {{ form.email }}
            {% if form.email.errors %}
              <div class="invalid-feedback d-block">{{ form.email.errors.0 }}</div>
            {% endif %}
          </div>
          <div class="col-md-6 mb-3">
            <label for="{{ form.telephone.id_for_label }}" class="form-label">{{ form.telephone.label }}</label>
            {{ form.telephone }}
            {% if form.telephone.errors %}
              <div class="invalid-feedback d-block">{{ form.telephone.errors.0 }}</div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    <!-- Section Hébergement (conditionnelle) -->
    <div class="card mb-4" id="section-hebergement">
      <div class="card-header">
        <h5 class="mb-0"><i class="bi bi-door-closed me-2"></i>Informations Hébergement</h5>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-4 mb-3">
            <label for="{{ form.numero_chambre.id_for_label }}" class="form-label">{{ form.numero_chambre.label }}</label>
            {{ form.numero_chambre }}
            {% if form.numero_chambre.errors %}
              <div class="invalid-feedback d-block">{{ form.numero_chambre.errors.0 }}</div>
            {% endif %}
          </div>
          <div class="col-md-4 mb-3">
            <label for="{{ form.date_arrivee.id_for_label }}" class="form-label">{{ form.date_arrivee.label }}</label>
            {{ form.date_arrivee }}
            {% if form.date_arrivee.errors %}
              <div class="invalid-feedback d-block">{{ form.date_arrivee.errors.0 }}</div>
            {% endif %}
          </div>
          <div class="col-md-4 mb-3">
            <label for="{{ form.date_depart.id_for_label }}" class="form-label">{{ form.date_depart.label }}</label>
            {{ form.date_depart }}
            {% if form.date_depart.errors %}
              <div class="invalid-feedback d-block">{{ form.date_depart.errors.0 }}</div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    <!-- Section Conférence/Événement (conditionnelle) -->
    <div class="card mb-4" id="section-conference" style="display: none;">
      <div class="card-header">
        <h5 class="mb-0"><i class="bi bi-calendar-event me-2"></i>Informations Conférence/Événement</h5>
      </div>
      <div class="card-body">
        <div class="mb-3">
          <label for="{{ form.nom_evenement.id_for_label }}" class="form-label">{{ form.nom_evenement.label }}</label>
          {{ form.nom_evenement }}
          {% if form.nom_evenement.errors %}
            <div class="invalid-feedback d-block">{{ form.nom_evenement.errors.0 }}</div>
          {% endif %}
        </div>
        <div class="mb-3">
          <label for="{{ form.salle.id_for_label }}" class="form-label">{{ form.salle.label }}</label>
          {{ form.salle }}
          {% if form.salle.errors %}
            <div class="invalid-feedback d-block">{{ form.salle.errors.0 }}</div>
          {% endif %}
          <div class="form-text">La salle est requise pour un client externe.</div>
        </div>
      </div>
    </div>

    <!-- Section Interne (conditionnelle) -->
    <div class="card mb-4" id="section-interne" style="display: none;">
      <div class="card-header">
        <h5 class="mb-0"><i class="bi bi-building me-2"></i>Informations Interne</h5>
      </div>
      <div class="card-body">
        <div class="mb-3">
          <label for="{{ form.departement.id_for_label }}" class="form-label">{{ form.departement.label }}</label>
          {{ form.departement }}
          {% if form.departement.errors %}
            <div class="invalid-feedback d-block">{{ form.departement.errors.0 }}</div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Notes -->
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0"><i class="bi bi-journal-text me-2"></i>Notes</h5>
      </div>
      <div class="card-body">
        <div class="mb-3">
          {{ form.notes }}
          {% if form.notes.errors %}
            <div class="invalid-feedback d-block">{{ form.notes.errors.0 }}</div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Dates (lecture seule) -->
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0"><i class="bi bi-calendar-check me-2"></i>Dates</h5>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="{{ form.date_creation.id_for_label }}" class="form-label">{{ form.date_creation.label }}</label>
            {{ form.date_creation }}
          </div>
          <div class="col-md-6 mb-3">
            <label for="{{ form.date_modification.id_for_label }}" class="form-label">{{ form.date_modification.label }}</label>
            {{ form.date_modification }}
          </div>
        </div>
      </div>
    </div>

    <!-- Boutons -->
    <div class="d-flex gap-2">
      <button type="submit" class="btn btn-primary">
        <i class="bi bi-check-circle me-1"></i>
        {% if client %}Modifier{% else %}Créer{% endif %}
      </button>
      <a href="{% url 'assets:client_list' %}" class="btn btn-secondary">
        <i class="bi bi-x-circle me-1"></i>Annuler
      </a>
    </div>
  </form>
</div>

<script>
  // Afficher/masquer les sections selon le type client
  document.getElementById('type_client').addEventListener('change', function() {
    const typeClient = this.value;
    document.getElementById('section-hebergement').style.display = typeClient === 'HEBERGEMENT' ? 'block' : 'none';
    document.getElementById('section-conference').style.display = typeClient === 'CONFERENCE' ? 'block' : 'none';
    document.getElementById('section-interne').style.display = typeClient === 'INTERNE' ? 'block' : 'none';
  });

  // Initialiser au chargement
  document.getElementById('type_client').dispatchEvent(new Event('change'));
</script>
{% endblock %}