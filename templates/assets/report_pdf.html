{% extends 'base.html' %}
{% block title %}Rapport {{ report.pk }} - PDF{% endblock %}
{% block content %}
<div style="font-family: Arial, Helvetica, sans-serif; padding: 18px; color: #222;">
  <div style="display:flex;justify-content:space-between;align-items:flex-start;">
    <div>
      <h1 style="margin:0 0 6px 0;font-size:20px;">Rapport d'activité — {{ report.pk }}</h1>
      <div style="color:#666;font-size:12px;">Date : {{ report.timestamp|date:"d/m/Y H:i:s" }}</div>
    </div>
    <div style="text-align:right;">
      {% if human_sentence %}
        <div style="background:#f6f8fa;padding:8px;border-left:4px solid #0d6efd;display:inline-block;max-width:420px;">{{ human_sentence }}</div>
      {% else %}
        <div style="background:#eee;padding:6px 8px;border-radius:4px;display:inline-block;">{{ report.get_action_display }}</div>
      {% endif %}
    </div>
  </div>

  <hr style="margin:12px 0;"/>

  <table style="width:90%;border-collapse:collapse;margin:0 auto 12px auto;">
    <tr>
      <td style="vertical-align:top;width:48%;padding:6px;text-align:left;">
        <strong>Contexte</strong>
        <div style="margin-top:6px;padding:8px;background:#f8f9fa;border-left:4px solid #0d6efd;">{{ context_sentence }}</div>
      </td>
      <td style="vertical-align:top;width:4%;"></td>
      <td style="vertical-align:top;width:48%;padding:6px;text-align:left;">
        <strong>Résumé</strong>
        <div style="font-size:12px;margin-top:6px;">{{ summary }}</div>
      </td>
    </tr>
  </table>

  <div style="margin-top:6px;margin-bottom:12px;width:90%;margin-left:auto;margin-right:auto;">
    <strong>Détails</strong>
    {% if formatted_changes %}
      <table style="width:100%;border-collapse:collapse;font-size:12px;margin-top:6px;">
        <thead>
          <tr style="background:#f0f0f0;"><th style="text-align:left;padding:6px;border:1px solid #e6e6e6;">Champ</th><th style="text-align:left;padding:6px;border:1px solid #e6e6e6;">Avant</th><th style="text-align:left;padding:6px;border:1px solid #e6e6e6;">Après</th></tr>
        </thead>
        <tbody>
        {% for c in formatted_changes %}
          <tr><td style="padding:6px;border:1px solid #eee;">{{ c.field }}</td><td style="padding:6px;border:1px solid #eee;color:#666;">{% if c.old is not None %}{{ c.old }}{% else %}&mdash;{% endif %}</td><td style="padding:6px;border:1px solid #eee;">{{ c.new|default:'&mdash;' }}</td></tr>
        {% endfor %}
        </tbody>
      </table>
    {% else %}
      <div style="font-size:12px;color:#666;margin-top:6px;">Aucun détail disponible.</div>
    {% endif %}
  </div>

  <footer style="position:fixed;bottom:12px;left:0;right:0;text-align:center;font-size:10px;color:#666;">
    © {% now "Y" %} RadGestMat — Gestion de Matériel
  </footer>
</div>
{% endblock %}
